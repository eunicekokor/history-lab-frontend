<!DOCTYPE html>
<html>

<head>
    <title>Viewing Doc {{ doc_id }}</title>
    <link rel='stylesheet' type='text/css' href="{{ url_for('static', filename='css/fabric.css')"/>
    <link rel='stylesheet' type='text/css' href="{{ url_for('static', filename='css/style.css')"/>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link href='http://fonts.googleapis.com/css?family=Lato&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="{{ url_for('static', filename='js/diff.min.js') }}"></script>
</head>

<body>
    <div class="container">
        <a href="/"> Back to Search </a>
        <p>Number of Versions: {{ result_textht | length }}</p>
        <div class="row">
            <div class="col-sm-3">
                <h1>Original Text</h1>
                <small>
                    <a target="_blank" href="/files/documents/{{ original['doc_id'] }}.nofoot.txt">view raw</a>
                </small>
                <div></div>
                {{ original["text"] }}
            </div>
            {% for redact in result_text %}
            <div class="col-sm-3">
                <h1> Redacted </h1>
                <small>
                    <a target="_blank" href="/files/documents/{{ redact['id'] }}.nofoot.txt">view raw</a>
                </small>
                <div></div>
                <div class="row"><pre id="display-{{loop.index0}}"></pre></div>
            </div>
            {% endfor %}
        </div>
    </div>
</body>

</html>
<script type="text/javascript">
    const original = {{ original_text['text'] }};
    const diffs = {{ result_text | safe }};

    diffs.forEach((res, i) => {
        const other = res.text;

        const diff = JsDiff.diffTrimmedLines(original, other);
        const display = document.getElementById('display-${i}');
        const fragment = document.createDocumentFragment();

        diff.forEach(part => {
            const color = part.added ? 'green' : part.removed ? 'red' : 'grey';
            const span = document.createElement('span');

            span.style.color = color;

            span.appendChild(document.createTextNode(part.value));
            fragment.appendChild(span);
            display.appendChild(fragment);
        });
    });
</script>
